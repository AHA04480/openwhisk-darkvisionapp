<div class="home container" ng-controller="HomeController as controller" layout="column">

  {{ filteredVideos = (controller.data.videos); "" }}
  {{ filteredImages = (controller.data.images); "" }}

  <div layout="row">
    <h2 ng-if="controller.data.showVideos && controller.data.showImages">
      All Uploads ({{filteredVideos.length + filteredImages.length}})
    </h2>
    <h2 ng-if="controller.data.showVideos && !controller.data.showImages">
      Videos ({{filteredVideos.length}})
    </h2>
    <h2 ng-if="!controller.data.showVideos && controller.data.showImages">
      Images ({{filteredImages.length}})
    </h2>
    <div flex></div>
    <div>
      Showing:
      <md-button class="button-group" ng-click="controller.data.showVideos = controller.data.showImages = true;" ng-disabled="controller.data.showVideos && controller.data.showImages">All Uploads</md-button>
      <md-button class="button-group" ng-click="controller.data.showVideos = true; controller.data.showImages = false;" ng-disabled="controller.data.showVideos && !controller.data.showImages">Videos</md-button>
      <md-button class="button-group" ng-click="controller.data.showVideos = false; controller.data.showImages = true;" ng-disabled="!controller.data.showVideos && controller.data.showImages">Images</md-button>
    </div>
  </div>

  <div flex="auto" ng-if="controller.data.showVideos">
    <h3 ng-if="controller.data.showImages">
      Video Uploads ({{filteredVideos.length}})
    </h3>

    <div layout="row" layout-align="space-between center" layout-wrap>
      <div ng-repeat="video in filteredVideos" class="video-box">
        <a ui-sref="video({ videoId: video._id })">
          <div ng-if="!video.metadata" class="video-box-image">
            This video has not yet been processed.
          </div>
          <div ng-if="video.metadata" class="video-box-image" style="background-image: url(/images/thumbnail/{{video._id}}.jpg);">
            <div class="video-box-tags" ng-repeat="stream in video.metadata.streams">
              <div ng-if="stream.codec_type == 'video'" class="text-muted">
                <span class="video-box-tag">{{stream.width}}x{{stream.height}}</span>
                <span class="video-box-tag">{{stream.duration | formatSeconds }}</span>
              </div>
            </div>
          </div>
        </a>
        <div class="video-box-title">
          {{video.title}}
        </div>
      </div>
    </div>
  </div>

  <div flex="auto" ng-if="controller.data.showImages">
    <h3 ng-if="controller.data.showVideos">
      Image Uploads ({{filteredImages.length}})
    </h3>

    <div>
      <div ng-repeat="image in filteredImages">
        <div id="image-{{image._id}}" layout="row" class="image-box">
          <div flex="initial" class="image-box-image">
            <div class="entry-thumbnail-container" style="position: relative;">
              <div ng-if="face.face_location.left>0" ng-repeat="face in image.analysis.face_detection" class="face-overlay-box" style="position: absolute;
                          top: {{controller.facePositionAsPercent(face.face_location, image).top}}%;
                          left: {{controller.facePositionAsPercent(face.face_location, image).left}}%;
                          width: {{controller.facePositionAsPercent(face.face_location, image).width}}%;
                          height: {{controller.facePositionAsPercent(face.face_location, image).height}}%;"><span class="face-overlay-text">{{$index+1}}</span></div>
              <img ng-src="/images/image/{{image._id}}.jpg" class="image-thumbnail" />
            </div>
          </div>
          <div flex class="entry-tags">
            <h4>Image Keywords</h4>
            <span ng-if="!image.analysis.image_keywords">No data yet</span>
            <span ng-if="image.analysis.image_keywords.length == 0">No tag detected</span>
            <ul class="entry-taglist">
              <li ng-repeat="keyword in image.analysis.image_keywords" class="entry-tag">
                <span class="tag tag-keyword">{{keyword.class}} {{keyword.score | formatPercent}}%</span>
              </li>
            </ul>
          </div>
          <div flex class="entry-faces">
            <h4>Face Detection</h4>
            <span ng-if="!image.analysis.face_detection">No data yet</span>
            <span ng-if="image.analysis.face_detection.length == 0">No face detected</span>
            <ul class="entry-taglist">
              <li ng-if="face.face_location.left>0" ng-repeat="face in image.analysis.face_detection" class="entry-tag">
                <span class="tag tag-face">
                  <span class="face-overlay-text">{{$index+1}}</span>
                  <span ng-if="face.identity">{{face.identity.name}} {{face.identity.score | formatPercent}}%</span>
                  <span ng-if="face.identity">&nbsp;</span>
                  <span>{{face.gender.gender}} {{face.age.min}}-{{face.age.max}} {{face.age.score | formatPercent}}%</span>
                </span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
